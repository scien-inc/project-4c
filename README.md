# README

## プロジェクト概要

本リポジトリは、「**課題エージェント**（顧客課題の深掘りを行い、ROIツリーを作成するエージェント）」と「**提案エージェント**（構築されたROIツリーを参照しながら最終的にROI試算やソリューション提案を行うエージェント）」という2種類のエージェントの実装例をまとめたものです。

エージェント同士を段階的に繋ぐことで、以下のようなフローを実現します。

1. **課題エージェント**がユーザにヒアリングや深掘り質問を行い、
   * 課題をROI（CostReduction / RevenueIncrease）軸で細分化
   * サブ要素（例: CR1, CR1a など）のノードを作成
   * ユーザと対話しながら「十分に深掘りできたか」をセルフリフレクションで判断し、完了すると終了

2. **提案エージェント**が上記で構築されたROIツリーをもとに、
   * 具体的な試算や提案を行うために追加で質問を投げかけ
   * 収集した情報から最終的なROI（金額・%増減など）を試算
   * セルフリフレクションで「提案が完了したか」を判断し、完了すると終了

本プロジェクトではLangGraphなどを用いてステートマシン風にチャットワークフローを制御し、**ストリーミング**で逐次会話を出力する仕組みを採用しています。

## ディレクトリ構造

```
roi_agents/
├── domain/
│   ├── roitree.py     # ROIツリーのデータ構造やユーティリティ
│   ├── schemas.py     # TypedDict などのスキーマ定義
│   └── __init__.py
├── agents/
│   ├── deepdive_agent.py   # 課題エージェントの実装
│   ├── proposal_agent.py   # 提案エージェントの実装
│   └── __init__.py
├── main.py            # コンソールからの実行例
├── streamlit_app.py   # Streamlitでのデモ用Webアプリ
├── requirements.txt   # 必要なライブラリ
└── README.md         # 本ファイル
```

## セットアップとインストール

1. **リポジトリをクローン**
```bash
git clone <このリポジトリのURL>
cd roi_agents
```

2. **依存パッケージをインストール**
以下のように `requirements.txt` を使ってインストールしてください。

```bash
pip install -r requirements.txt
```

もしGPU対応やLangChainのバージョン調整が必要であれば、適宜環境を整えてください。

3. **環境変数の設定**
   * OpenAIのAPIキーなどが必要です。
   * `.env` ファイルや `os.environ["OPENAI_API_KEY"]` の形で設定してください。

## 使い方（コンソール実行）

1. **課題エージェント＆提案エージェントの実行（対話ストリーミング）**
```bash
python main.py
```
   * まず「課題エージェント」が起動し、深掘り対話を行います。
   * 規定の反復回数が終了するとROIツリーが（仮想的に）完成します。
   * 次に「提案エージェント」が起動し、ROIツリーを用いた提案と試算が実行されます。
   * 各ステップで生成された対話がコンソールにストリーミング出力されます。

## Streamlitデモ

`streamlit_app.py` を使ってWebブラウザ上で実際にエージェントとやりとりするデモを行えます。

```bash
streamlit run streamlit_app.py
```

* ブラウザが自動的に開き、対話画面が表示されます。
* 「課題エージェントで深掘り」ボタンを押すとステートマシンが起動し、エージェントとのやりとりが順次出力されます。
* 深掘りが完了するとROIツリーが表示されます。
* 続いて「提案エージェントで試算」ボタンを押すと、提案エージェントが起動し、ROIツリーを参照しながら追加質問と試算を行うフローを体験できます。

## ファイル詳細

1. `domain/roitree.py`
   * `ROINode` クラスでROIツリーの最小構成要素を定義
   * ノード追加メソッドや、ツリーを辞書に変換するメソッドを持ちます。

2. `domain/schemas.py`
   * **DeepdiveState**：課題エージェント用の状態を格納するTypedDict
   * **ProposalState**：提案エージェント用の状態を格納するTypedDict

3. `agents/deepdive_agent.py`
   * 課題エージェントの各ノード処理を定義
   * 「課題をどう深掘りするかの対話」「セルフリフレクションして継続 or 終了判断」を行います。

4. `agents/proposal_agent.py`
   * 提案エージェントの各ノード処理を定義
   * 「既存のROIツリーを参照しながら、最終ROIを算出する対話」「継続 or 終了判断」を行います。

5. `main.py`
   * コンソールでの動作例をまとめたサンプル
   * Streamlitなしで一連のエージェントフローをテストしたい場合に使用します。

6. `streamlit_app.py`
   * Streamlitを用いて、ブラウザでエージェントとの対話を行うデモ
   * 「課題エージェントのフローを開始」「提案エージェントのフローを開始」ボタンなどのUIを実装
   * (後述のサンプルコードを参照)

7. `requirements.txt`
   * 本プロジェクトで使用している主なライブラリの一覧（LangGraph, LangChain, Streamlitなど）